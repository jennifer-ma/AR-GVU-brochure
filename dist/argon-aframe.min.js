!function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){i(7),i(5),i(6),i(9),i(8),i(10)},function(t,e,i){var n=i(4),a={alternate:"alternate",alternateReverse:"alternate-reverse",normal:"normal",reverse:"reverse"},r={linear:n.Easing.Linear.None,ease:n.Easing.Cubic.InOut,"ease-in":n.Easing.Cubic.In,"ease-out":n.Easing.Cubic.Out,"ease-in-out":n.Easing.Cubic.InOut,"ease-cubic":n.Easing.Cubic.In,"ease-in-cubic":n.Easing.Cubic.In,"ease-out-cubic":n.Easing.Cubic.Out,"ease-in-out-cubic":n.Easing.Cubic.InOut,"ease-quad":n.Easing.Quadratic.InOut,"ease-in-quad":n.Easing.Quadratic.In,"ease-out-quad":n.Easing.Quadratic.Out,"ease-in-out-quad":n.Easing.Quadratic.InOut,"ease-quart":n.Easing.Quartic.InOut,"ease-in-quart":n.Easing.Quartic.In,"ease-out-quart":n.Easing.Quartic.Out,"ease-in-out-quart":n.Easing.Quartic.InOut,"ease-quint":n.Easing.Quintic.InOut,"ease-in-quint":n.Easing.Quintic.In,"ease-out-quint":n.Easing.Quintic.Out,"ease-in-out-quint":n.Easing.Quintic.InOut,"ease-sine":n.Easing.Sinusoidal.InOut,"ease-in-sine":n.Easing.Sinusoidal.In,"ease-out-sine":n.Easing.Sinusoidal.Out,"ease-in-out-sine":n.Easing.Sinusoidal.InOut,"ease-expo":n.Easing.Exponential.InOut,"ease-in-expo":n.Easing.Exponential.In,"ease-out-expo":n.Easing.Exponential.Out,"ease-in-out-expo":n.Easing.Exponential.InOut,"ease-circ":n.Easing.Circular.InOut,"ease-in-circ":n.Easing.Circular.In,"ease-out-circ":n.Easing.Circular.Out,"ease-in-out-circ":n.Easing.Circular.InOut,"ease-elastic":n.Easing.Elastic.InOut,"ease-in-elastic":n.Easing.Elastic.In,"ease-out-elastic":n.Easing.Elastic.Out,"ease-in-out-elastic":n.Easing.Elastic.InOut,"ease-back":n.Easing.Back.InOut,"ease-in-back":n.Easing.Back.In,"ease-out-back":n.Easing.Back.Out,"ease-in-out-back":n.Easing.Back.InOut,"ease-bounce":n.Easing.Bounce.InOut,"ease-in-bounce":n.Easing.Bounce.In,"ease-out-bounce":n.Easing.Bounce.Out,"ease-in-out-bounce":n.Easing.Bounce.InOut},o={backwards:"backwards",both:"both",forwards:"forwards",none:"none"},s={indefinite:"indefinite"},c={attribute:"rotation",begin:"",end:"",delay:0,dur:1e3,easing:"ease",direction:a.normal,fill:o.forwards,from:void 0,repeat:0,to:void 0};t.exports.defaults=c,t.exports.directions=a,t.exports.easingFunctions=r,t.exports.fills=o,t.exports.repeats=s},function(t,e,i){t.exports={AFRAME_INJECTED:"aframe-injected",animation:i(1),keyboardevent:i(3)}},function(t,e){t.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},function(t,e,i){var n,a;!function(t){if("performance"in t==!1&&(t.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in t.performance==!1){var e=t.performance.timing&&t.performance.timing.navigationStart?performance.timing.navigationStart:Date.now();t.performance.now=function(){return Date.now()-e}}}(this);var r=r||function(){var t=[];return{REVISION:"14",getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var i=t.indexOf(e);i!==-1&&t.splice(i,1)},update:function(e){if(0===t.length)return!1;var i=0;for(e=void 0!==e?e:window.performance.now();i<t.length;)t[i].update(e)?i++:t.splice(i,1);return!0}}}();r.Tween=function(t){var e=t,i={},n={},a={},o=1e3,s=0,c=!1,u=!1,l=!1,d=0,h=null,f=r.Easing.Linear.None,p=r.Interpolation.Linear,v=[],g=null,m=!1,E=null,b=null,y=null;for(var A in t)i[A]=parseFloat(t[A],10);this.to=function(t,e){return void 0!==e&&(o=e),n=t,this},this.start=function(t){r.add(this),u=!0,m=!1,h=void 0!==t?t:window.performance.now(),h+=d;for(var o in n){if(n[o]instanceof Array){if(0===n[o].length)continue;n[o]=[e[o]].concat(n[o])}i[o]=e[o],i[o]instanceof Array==!1&&(i[o]*=1),a[o]=i[o]||0}return this},this.stop=function(){return u?(r.remove(this),u=!1,null!==y&&y.call(e),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var t=0,e=v.length;t<e;t++)v[t].stop()},this.delay=function(t){return d=t,this},this.repeat=function(t){return s=t,this},this.yoyo=function(t){return c=t,this},this.easing=function(t){return f=t,this},this.interpolation=function(t){return p=t,this},this.chain=function(){return v=arguments,this},this.onStart=function(t){return g=t,this},this.onUpdate=function(t){return E=t,this},this.onComplete=function(t){return b=t,this},this.onStop=function(t){return y=t,this},this.update=function(t){var r;if(t<h)return!0;m===!1&&(null!==g&&g.call(e),m=!0);var u=(t-h)/o;u=u>1?1:u;var y=f(u);for(r in n){var A=i[r]||0,w=n[r];w instanceof Array?e[r]=p(w,y):("string"==typeof w&&(w=A+parseFloat(w,10)),"number"==typeof w&&(e[r]=A+(w-A)*y))}if(null!==E&&E.call(e,y),1==u){if(s>0){isFinite(s)&&s--;for(r in a){if("string"==typeof n[r]&&(a[r]=a[r]+parseFloat(n[r],10)),c){var I=a[r];a[r]=n[r],n[r]=I}i[r]=a[r]}return c&&(l=!l),h=t+d,!0}null!==b&&b.call(e);for(var O=0,R=v.length;O<R;O++)v[O].start(t);return!1}return!0}},r.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)))},Out:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/n)+1)},InOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)):i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-r.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*r.Easing.Bounce.In(2*t):.5*r.Easing.Bounce.Out(2*t-1)+.5}}},r.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,a=Math.floor(n),o=r.Interpolation.Utils.Linear;return e<0?o(t[0],t[1],n):e>1?o(t[i],t[i-1],i-n):o(t[a],t[a+1>i?i:a+1],n-a)},Bezier:function(t,e){var i,n=0,a=t.length-1,o=Math.pow,s=r.Interpolation.Utils.Bernstein;for(i=0;i<=a;i++)n+=o(1-e,a-i)*o(e,i)*t[i]*s(a,i);return n},CatmullRom:function(t,e){var i=t.length-1,n=i*e,a=Math.floor(n),o=r.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(a=Math.floor(n=i*(1+e))),o(t[(a-1+i)%i],t[a],t[(a+1)%i],t[(a+2)%i],n-a)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(o(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):o(t[a?a-1:0],t[a],t[i<a+1?i:a+1],t[i<a+2?i:a+2],n-a)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=r.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i,n=1;if(t[e])return t[e];for(i=e;i>1;i--)n*=i;return t[e]=n}}(),CatmullRom:function(t,e,i,n,a){var r=.5*(i-t),o=.5*(n-e),s=a*a,c=a*s;return(2*e-2*i+r+o)*c+(-3*e+3*i-2*r-o)*s+r*a+e}}},function(i){n=[],a=function(){return r}.apply(e,n),!(void 0!==a&&(t.exports=a))}(this)},function(t,e){var i=1e-5;AFRAME.registerComponent("fixedsize",{schema:{"default":1},init:function(){this.scale=1,this.factor=1},update:function(){var t=this.data;this.scale=0===t?i:t,this.factor=2*(this.scale/screen.height)},tick:function(t){var e=this.el.object3D,i=this.el.sceneEl.camera;if(i){var n=i.getWorldPosition(),a=e.getWorldPosition(),r=a.distanceTo(n);fovScale=2*Math.tan(THREE.Math.degToRad(i.fov)/2);var o=fovScale*(r<i.near?this.factor:r*this.factor);e.scale.set(o,o,o)}}}),AFRAME.registerComponent("trackvisibility",{schema:{"default":!0},init:function(){var t=this;console.log("INIT TEST COMPONENT"),this.el.sceneEl.addEventListener("referenceframe-statuschanged",function(e){t.updateVisibility(e)})},updateVisibility:function(t){console.log("visibility changed: "+t.detail.found),this.data&&t.detail.target===this.el&&(this.el.object3D.visible=t.detail.found)},update:function(){console.log("updated TEST COMPONENT")}})},function(t,e){var i=Argon.Cesium,n=i.Cartesian3,a=i.ConstantPositionProperty,r=i.ReferenceFrame,o=i.ReferenceEntity,s=THREE.Math.degToRad;AFRAME.registerComponent("referenceframe",{schema:{lla:{type:"vec3"},parent:{"default":"FIXED"},userotation:{"default":!0},useposition:{"default":!0}},init:function(){var t=this.el,e=this;if(this.update=this.update.bind(this),!t.sceneEl.isArgon)throw new Error("referenceframe must be used on a child of a <ar-scene>.");this.localRotationEuler=new THREE.Euler(0,0,0,"XYZ"),this.localPosition={x:0,y:0,z:0},this.localScale={x:1,y:1,z:1},this.knownFrame=!1,t.addEventListener("componentchanged",this.updateLocalTransform.bind(this)),t.sceneEl.addEventListener("argon-initialized",function(){e.update(e.data)})},update:function(t){var e=this.el,r=this.el.sceneEl.argonApp,o=this.data,c=e.getComputedAttribute("position");c?(this.localPosition.x=c.x,this.localPosition.y=c.y,this.localPosition.z=c.z):(this.localPosition.x=0,this.localPosition.y=0,this.localPosition.z=0);var u=e.getComputedAttribute("rotation");u?(this.localRotationEuler.x=s(u.x),this.localRotationEuler.y=s(u.y),this.localRotationEuler.z=s(u.z)):(this.localRotationEuler.x=0,this.localRotationEuler.y=0,this.localRotationEuler.z=0);var l=e.getComputedAttribute("scale");if(l?(this.localScale.x=l.x,this.localScale.y=l.y,this.localScale.z=l.z):(this.localScale.x=1,this.localScale.y=1,this.localScale.z=1),r){var d=null;this.attrValue.hasOwnProperty("lla")?("FIXED"!==o.parent&&(console.warn("Using 'lla' with a 'parent' other than 'FIXED' is invalid. Ignoring parent value."),o.parent="FIXED"),d=n.fromDegrees(o.lla.x,o.lla.y,o.lla.z)):d=n.ZERO;var h=this.getParentEntity(o.parent);if(null==this.cesiumEntity||""!==e.id&&e.id!==this.cesiumEntity.id){var f={position:new a(d,h),orientation:i.Quaternion.IDENTITY};""!==e.id&&(f.id=e.id),this.cesiumEntity=new i.Entity(f)}else this.cesiumEntity.position.setValue(d,h)}},getParentEntity:function(t){var e=this.el,i=this,n=this.el.sceneEl.argonApp,a=null;if("FIXED"===t)a=r.FIXED;else{var s=e.sceneEl.systems.vuforia;if(s){var c=t.split(".");if(3===c.length&&"vuforia"===c[0]&&(console.log("looking for target '"+t+"'"),a=s.getTargetEntity(c[1],c[2]),null===a&&(console.log("not found, subscribing to target '"+t+"'"),a=s.subscribeToTarget(c[1],c[2])),null===a)){console.log("not loaded, waiting for dataset for target '"+t+"'");var u=c[1];e.sceneEl.addEventListener("argon-vuforia-dataset-loaded",function(t){console.log("dataset loaded."),console.log("dataset name '"+t.detail.target.name+"', our name '"+u+"'"),t.detail.target.name===u&&i.update(i.data)}),console.log("finished setting up to wait for dataset for target '"+t+"'")}}a||(a=n.context.entities.getById(t)),a||(a=new o(n.context.entities,t))}return a},convertReferenceFrame:function(t){var e=this.el;if(!this.cesiumEntity)return void console.warn("Tried to convertReferenceFrame on element '"+e.id+"' but no cesiumEntity initialized on that element")},updateLocalTransform:function(t){var e=t.detail.newData;t.target==this.el&&("rotation"==t.detail.name?(this.localRotationEuler.x=s(e.x),this.localRotationEuler.y=s(e.y),this.localRotationEuler.z=s(e.z)):"position"==t.detail.name?(this.localPosition.x=e.x,this.localPosition.y=e.y,this.localPosition.z=e.z):"scale"==t.detail.name&&(this.localScale.x=e.x,this.localScale.y=e.y,this.localScale.z=e.z))},tick:function(){var t=new THREE.Matrix4;return function(e){var i=this.data,n=this.el,a=n.object3D,r=a.matrix,o=n.sceneEl.argonApp,s=!n.parentEl.isScene;if(o&&this.cesiumEntity){var c=o.context.getEntityPose(this.cesiumEntity);c.poseStatus&Argon.PoseStatus.KNOWN?(this.knownFrame=!0,i.userotation?a.quaternion.copy(c.orientation):s&&(a.rotation.copy(this.localRotationEuler),a.rotation.order="YXZ"),i.useposition?a.position.copy(c.position):s&&a.position.copy(this.localPosition),c.poseStatus&Argon.PoseStatus.FOUND&&(console.log("reference frame changed to FOUND"),n.sceneEl.emit("referenceframe-statuschanged",{target:this.el,found:!0})),n.parentEl.isScene||(a.scale.set(1,1,1),n.parentEl.object3D.updateMatrixWorld(),t.getInverse(n.parentEl.object3D.matrixWorld),r.premultiply(t),r.decompose(a.position,a.quaternion,a.scale))):(this.knownFrame=!1,c.poseStatus&Argon.PoseStatus.LOST&&(console.log("reference frame changed to LOST"),n.sceneEl.emit("referenceframe-statuschanged",{target:this.el,found:!1})))}}}()}),AFRAME.registerPrimitive("ar-geopose",{defaultComponents:{referenceframe:{}},mappings:{lla:"referenceframe.lla",userotation:"referenceframe.userotation",useposition:"referenceframe.useposition"}}),AFRAME.registerPrimitive("ar-frame",{defaultComponents:{referenceframe:{}},mappings:{parent:"referenceframe.parent",userotation:"referenceframe.userotation",useposition:"referenceframe.useposition"}})},function(t,e,n){var a=AFRAME.AEntity,r=AFRAME.ANode,o=n(2),s="data-aframe-argon-camera",c=document.createElement("style");c.type="text/css",document.head.insertBefore(c,document.head.firstChild);var u=c.sheet;u.insertRule("ar-scene {\n  display: block;\n  position: relative;\n  height: 100%;\n  width: 100%;\n}\n",0),u.insertRule("\nar-scene video,\nar-scene img,\nar-scene audio {\n  display: none;\n}\n",1),document.DOMReady=function(){return new Promise(function(t,e){"complete"===document.readyState?t(document):document.addEventListener("DOMContentLoaded",function(){t(document)})})},AFRAME.registerElement("ar-scene",{prototype:Object.create(a.prototype,{createdCallback:{value:function(){this.isMobile=AFRAME.utils.isMobile(),this.isIOS=AFRAME.utils.isIOS(),this.isScene=!0,this.isArgon=!0,this.object3D=new THREE.Scene,this.systems={},this.time=0,this.argonApp=null,this.init()}},init:{value:function(){this.behaviors=[],this.hasLoaded=!1,this.isPlaying=!1,this.originalHTML=this.innerHTML,this.argonApp=Argon.init(),this.argonApp.context.setDefaultReferenceFrame(this.argonApp.context.localOriginEastUpSouth),this.argonRender=this.argonRender.bind(this),this.argonUpdate=this.argonUpdate.bind(this),this.initializeArgon=this.initializeArgon.bind(this),this.setupRenderer=this.setupRenderer.bind(this),document.DOMReady().then(this.initializeArgon)},writable:!0},attachedCallback:{value:function(){this.setupSystems(),this.play()},writable:window.debug},addEventListeners:{value:function(){this.argonApp.renderEvent.addEventListener(this.argonRender),this.argonApp.updateEvent.addEventListener(this.argonUpdate)},writable:!0},removeEventListeners:{value:function(){this.argonApp.updateEvent.removeEventListener(this.argonUpdate),this.argonApp.renderEvent.removeEventListener(this.argonRender)},writable:!0},play:{value:function(){var t=this;return this.renderStarted?void a.prototype.play.call(this):(this.addEventListener("loaded",function(){this.renderStarted||(this.addEventListener("camera-set-active",function(){var e=null,n=this.querySelectorAll("[camera]");for(i=0;i<n.length;i++)cameraEl=n[i],"AR-CAMERA"!==cameraEl.tagName?(cameraEl.setAttribute("camera","active",!1),cameraEl.pause()):e=cameraEl;if(null==e){var a=document.createElement("ar-camera");a.setAttribute(s,""),a.setAttribute(o.AFRAME_INJECTED,""),t.appendChild(a)}}),this.argonApp?t.addEventListeners():this.addEventListener("argon-initialized",function(){t.addEventListeners()}),a.prototype.play.call(this),window.performance&&window.performance.mark("render-started"),this.renderStarted=!0,this.emit("renderstart"))}),void setTimeout(function(){a.prototype.load.call(t)}))}},detachedCallback:{value:function(){this.animationFrameID&&(cancelAnimationFrame(this.animationFrameID),this.animationFrameID=null),removeEventListenern()}},initializeArgon:{value:function(){this.setupRenderer(),this.emit("argon-initialized",{target:this.argonApp})},writable:!0},setupRenderer:{value:function(){var t="true"===this.getAttribute("antialias");THREE.CSS3DArgonRenderer?this.cssRenderer=new THREE.CSS3DArgonRenderer:this.cssRenderer=null,THREE.CSS3DArgonHUD?this.hud=new THREE.CSS3DArgonHUD:this.hud=null,this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:t,logarithmicDepthBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.argonApp.view.element.appendChild(this.renderer.domElement),this.cssRenderer&&this.argonApp.view.element.appendChild(this.cssRenderer.domElement),this.hud&&this.argonApp.view.element.appendChild(this.hud.domElement)},writable:!0},reload:{value:function(t){function e(){i.isPlaying&&a.prototype.play.call(i)}var i=this;t&&this.pause(),this.innerHTML=this.originalHTML,this.init(),r.prototype.load.call(this,e)}},argonUpdate:{value:function(t){var e=t.systemTime,i=t.deltaTime;this.isPlaying&&this.tick(e,i),this.time=e},writable:!0},tick:{value:function(t,e){var i=this.systems;TWEEN.update(t),this.behaviors.forEach(function(i){i.el.isPlaying&&i.tick(t,e)}),Object.keys(i).forEach(function(n){i[n].tick&&i[n].tick(t,e)})}},argonRender:{value:function(t){if(!this.animationFrameID){var e=this.argonApp;this.rAFviewport=e.view.getViewport(),this.rAFsubViews=e.view.getSubviews(),this.animationFrameID=requestAnimationFrame(this.rAFRenderFunc.bind(this))}},writable:!0},rAFviewport:{value:null,writable:!0},rAFsubViews:{value:null,writable:!0},rAFRenderFunc:{value:function(){var t=this.object3D,e=this.renderer,i=this.cssRenderer,n=this.hud,a=this.camera;if(!this.renderer)return void(this.animationFrameID=null);var r=null,o=null;a.parent&&(r=a.parent.position.clone().negate(),o=a.parent.quaternion.clone().inverse());var s=this.rAFviewport;e.setSize(s.width,s.height),this.cssRenderer&&i.setSize(s.width,s.height),this.hud&&n.setSize(s.width,s.height);var c=this.rAFsubViews;this.is("vr-mode")?1==c.length&&(this.removeState("vr-mode"),this.emit("exit-vr",{target:this})):c.length>1&&(this.addState("vr-mode"),this.emit("enter-vr",{target:this})),a.near=c[0].frustum.near,a.far=c[0].frustum.far,a.aspect=c[0].frustum.aspect;for(var u=0;u<c.length;u++){var l=c[u],d=l.frustum;a.position.copy(l.pose.position),r&&a.position.add(r),a.quaternion.copy(l.pose.orientation),o&&a.quaternion.multiply(o),a.projectionMatrix.fromArray(l.projectionMatrix);var h=l.viewport,f=h.x,p=h.y,v=h.width,g=h.height;this.cssRenderer&&(a.fov=THREE.Math.radToDeg(d.fovy),i.setViewport(f,p,v,g,l.index),i.render(t,a,l.index)),e.setViewport(f,p,v,g),e.setScissor(f,p,v,g),e.setScissorTest(!0),e.render(t,a),this.hud&&(n.setViewport(f,p,v,g,l.index),n.render(l.index))}this.animationFrameID=null},writable:!0},setupSystems:{value:function(){var t=Object.keys(AFRAME.systems);t.forEach(this.initSystem.bind(this))}},initSystem:{value:function(t){var e;this.systems[t]||(e=this.systems[t]=new AFRAME.systems[t](this),e.init())}},addBehavior:{value:function(t){var e=this.behaviors;e.indexOf(t)===-1&&e.push(t)}},getAttribute:{value:function(t){var e=this.systems[t];return e?e.data:a.prototype.getAttribute.call(this,t)}},getComputedAttribute:{value:function(t){var e=this.systems[t];return e?e.data:a.prototype.getComputedAttribute.call(this,t)}},setAttribute:{value:function(t,e,i){var n=this.systems[t];return n?void r.prototype.setAttribute.call(this,t,e):void a.prototype.setAttribute.call(this,t,e,i)}},removeBehavior:{value:function(t){var e=this.behaviors,i=e.indexOf(t);i!==-1&&e.splice(i,1)}}})}),AFRAME.registerPrimitive("ar-camera",{defaultComponents:{camera:{active:!0},referenceframe:{parent:"ar.user"}}})},function(t,e){AFRAME.registerSystem("vuforia",{init:function(){this.key="",this.api=null,this.datasetMap={},this.available=!1,this.sceneEl.addEventListener("argon-initialized",this.startVuforia.bind(this))},setKey:function(t){this.key=t,this.sceneEl.argonApp&&this.startVuforia()},startVuforia:function(){var t=this,e=this.sceneEl,i=e.argonApp;i&&i.vuforia&&(this.api||""!==this.key&&i.vuforia.isAvailable().then(function(n){if(!t.available){if(!n)return t.available=!1,console.warn("vuforia not available on this platform."),void e.emit("argon-vuforia-not-available",{target:e});t.available=!0,i.vuforia.init({encryptedLicenseData:t.key}).then(function(i){t.api=i,console.log("vuforia initialized!"),Object.keys(t.datasetMap).forEach(function(e,i){var n=t.datasetMap[e];console.log("re-initializing dataset "+e+" as active="+n.active),t.createOrUpdateDataset(n.component,e,n.url,n.active)}),e.emit("argon-vuforia-initialized",{target:e})})["catch"](function(t){console.log("vuforia failed to initialize: "+t.message),e.emit("argon-vuforia-initialization-failed",{target:e,error:t})})}}))},createEmptyDatasetObject:function(){return{component:null,api:null,url:null,fetched:!1,loaded:!1,active:!1,targets:{},trackables:null,initInProgress:!1}},createOrUpdateDataset:function(t,e,i,n){var a=this,r=this.api,o=this.datasetMap[e];if(o)if(o.component){if(o.component!=t)return void console.warn("vuforia.createOrUpdateDataset called multiple times for id="+e+", ignoring extra datasets");if(o.url!=i)return void console.warn("can't change the url for a vuforia dataset once it's created.  Ignoring new URL '"+i+"' for dataset '"+e+"'")}else o.component=t,o.url=i;else o=this.datasetMap[e]=this.createEmptyDatasetObject(),o.component=t,o.url=i;if(o.active=n,console.log("creating dataset "+e+" active="+n),r){if(o.initInProgress)return void(o.active=n);if(o.api)return o.active=n,void(fetched&&a.setDatasetActive(e,o.active));console.log("objectTracker.createDataSet "+e),o.initInProgress=!0,r.objectTracker.createDataSet(i).then(function(t){console.log("created dataset "+e),o.initInProgress=!1,o.api=t,t.fetch().then(function(){console.log("fetched dataset "+e),o.fetched=!0,console.log("now, re-activate dataset "+e+" active="+o.active),a.setDatasetActive(e,o.active),o.component.datasetLoaded=!0,console.log("re-activated dataset "+e+" active="+o.active),a.sceneEl.emit("argon-vuforia-dataset-downloaded",{target:o.component})})["catch"](function(t){console.log("couldn't download dataset: "+t.message),sceneEl.emit("argon-vuforia-dataset-download-failed",{target:sceneEl,error:t})})})}},setDatasetActive:function(t,e){var i=this,n=this.api,a=this.datasetMap[t];if(console.log("make dataset "+t+" active="+e),!n){if(a)return void(a.active=e);throw new Error("vuforia.setDatsetActive call before dataset initialized")}if(!a)throw new Error('ar-vuforia-dataset "'+t+'" should have been created before being activated');console.log("really making dataset "+t+" active="+e),!a.loaded&&e?(console.log("loading dataset "+t+" active="+e),a.api.load().then(function(){console.log("loaded dataset "+t+" active="+e),a.loaded||(a.loaded=!0,a.fetched=!0,a.trackables=a.api.getTrackables(),e&&(a.active=!0,n.objectTracker.activateDataSet(a.api)),Object.keys(a.targets).forEach(function(e,n){console.log("re-subscribing to target "+t+"."+e),i.subscribeToTarget(t,e,!0)}),i.sceneEl.emit("argon-vuforia-dataset-loaded",{target:a.component}),console.log("dataset "+t+" loaded, ready to go"))})["catch"](function(t){console.log("couldn't load dataset: "+t.message),sceneEl.emit("argon-vuforia-dataset-load-failed",{target:sceneEl,error:t})})):a.active!=e&&(a.active=e,e?n.objectTracker.activateDataSet(a.api):n.objectTracker.deactivateDataSet(a.api))},subscribeToTarget:function(t,e,i){var n=this.api,a=this.datasetMap[t];if(a||(a=this.datasetMap[t]=this.createEmptyDatasetObject()),targetItem=a.targets[e],targetItem?i||(a.targets[e]+=1):a.targets[e]=1,console.log("subscribe to "+t+"."+e),!n)return null;if(a.loaded){var r=a.trackables[e];return console.log("dataset loaded, subscribe to "+t+"."+e),r&&r.id?(console.log("subscribed to "+t+"."+e+" as "+r.id),this.sceneEl.argonApp.context.subscribeToEntityById(r.id)):(console.warn("can't subscribe to target '"+e+"' does not exist in dataset '"+t+"'"),null)}return null},getTargetEntity:function(t,e){var i,n=this.api,a=this.datasetMap[t];return console.log("getTargetEntity "+t+"."+e),n&&a&&a.loaded?(i=a.trackables[e],console.log("everything loaded, get "+t+"."+e),i&&i.id?(console.log("retrieved "+t+"."+e+" as "+i.id),this.sceneEl.argonApp.context.entities.getById(i.id)):(console.warn("can't get target '"+e+"', does not exist in dataset '"+t+"'"),null)):null}}),AFRAME.registerComponent("vuforiakey",{schema:{"default":" "},init:function(){this.key=null},update:function(t){var e=this.el,i=this.el.sceneEl,n=i.systems.vuforia;if(!e.isArgon)return void console.warn("vuforia component can only be applied to <ar-scene>");var a=e.querySelector(this.data);return a?void(a.isAssetItem?(this.key=a.data,n.setKey(a.data)):(this.key=a.innerHTML,n.setKey(a.innerHTML))):void console.warn('vuforia component cannot find asset "'+this.data+'"')}}),AFRAME.registerComponent("vuforiadataset",{multiple:!0,schema:{src:{type:"src"},active:{"default":!0}},init:function(){var t=this.el;this.name="default_dataset",this.active=!1,this.datasetLoaded=!1,t.isArgon||console.warn("vuforiadataset should be attached to an <ar-scene>.")},remove:function(){if(this.active){var t=this.el.sceneEl,e=t.systems.vuforia;e.setDatasetActive(this.name,!1)}},update:function(t){var e=this.el.sceneEl;this.name=this.id?this.id:"default_dataset";var i=e.systems.vuforia;i.createOrUpdateDataset(this,this.name,this.data.src,this.data.active)}})},function(t,e){AFRAME.registerComponent("css-object",{schema:{div:{"default":""},div2:{"default":""}},init:function(){this.div=null,this.div2=null},update:function(){var t=this.data;""!==t.div&&(this.div=document.querySelector(t.div),""!==t.div2&&(this.div2=document.querySelector(t.div2)),this.div&&THREE.CSS3DObject&&(null===this.div2?this.el.setObject3D("div",new THREE.CSS3DObject(this.div)):this.el.setObject3D("div",new THREE.CSS3DObject([this.div,this.div2]))))},remove:function(){this.div&&THREE.CSS3DObject&&this.el.removeObject3D("div")}})},function(t,e){AFRAME.registerShader("shadow",{schema:{},init:function(t){this.textureSrc=null,this.material=new THREE.ShadowMaterial,AFRAME.utils.material.updateMap(this,t)},update:function(t){AFRAME.utils.material.updateMap(this,t)}})}]);